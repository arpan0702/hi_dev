{% extends 'admin/layouts/main.html' %}
{% block title %}List of Customers{% endblock %}
{% block content %}

<div class="pt-4 px-2">
  <div class="col-lg-12">
    <div class="card card-dark" style="border: 2px solid #e3ebf6;">
      <div class="card-header">
        <h4 class="card-title" style="font-size: 17px;font-weight: 600;">Edit Program Offer</h4>
      </div>
      <div class="card-body">
        <form method="post" id="form">
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Card Program</label>
                <div class="col-sm-9">
                  <select name="card_program" id="card_program" class="form-control" tabindex="1">
                    <option value="{{selected_card_program.id}}">{{selected_card_program.name}}</option>
                    {%for card_program in card_programs_data %}

                    <option value="{{card_program.id}}">{{card_program.name}}</option>

                    {% endfor %}
                  </select>
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Offer Name</label>
                <div class="col-sm-9">
                  <input name="offer_name" id="offer_name" class="form-control" tabindex="3"
                    value="{{offer.offer_name}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">MID</label>
                <div class="col-sm-9">
                  <input name="mid" id="mid" class="form-control" tabindex="5" value="{{offer.mid}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
              {%set middle_data = offer.transaction_label.split(' ')[2]%}
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Narration</label>
                <div class="col-sm-6 mt-2">
                  <div class="custom-control custom-radio">
                    <input type="radio" id="mid_transaction" name="transaction_label" value="mid"
                       {{ "checked" if (middle_data==offer.mid) else "" }}>
                    <label for="mid">Cashback - MID transaction</label><br>
                  </div>
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">MCC</label>
                <div class="col-sm-9">
                  <select name="mcc" id="mcc" class="form-control" tabindex="2">
                    <option value="{{offer.mcc}}">{{offer.mcc}}</option>
                    {%for mcc in mccs %}
                    {% if (mcc!=offer.mcc)%}
                    <option value="{{mcc}}">{{mcc}}</option>
                    {% endif %}
                    {% endfor %}
                  </select>
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
              <div class="form-group row">

                <div class="col-sm-9" style="margin-top: 10px !important;margin-left: auto;">
                  <div class="custom-control custom-radio">
                    <input type="radio" id="transaction_label" name="transaction_label" 
                      value="mcc" {{ "checked" if (middle_data==offer.mcc) else "" }}>
                    <label for="mcc">Cashback - MCC transaction</label><br>
                  </div>
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <hr class="dark-line">
          <div class="row panel panel-default">

            <div class="col-lg-6">

              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Offer Start</label>
                <div class="col-sm-9">
                  <input oninput="DateValidation()" name="offer_start_date" id="offer_start_date" class="form-control"
                    type="date" tabindex="7" value="{{offer.offer_start_date}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>

            </div>
            <div class="col-lg-6">
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Offer End</label>
                <div class="col-sm-9">
                  <input name="offer_end_date" id="offer_end_date" class="form-control" type="date" tabindex="6"
                    value="{{offer.offer_end_date}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
          <hr class="dark-line">
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Minimum Spend</label>
                <div class="col-sm-9">
                  <input name="min_spend" id="min_spend" class="form-control" tabindex="4" value="{{offer.min_spend}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>


            </div>
            <div class="col-lg-6">




            </div>

          </div>
          {% set flat = offer.per_Transaction_cashback_flat | int %}
          {% set percent = offer.per_Transaction_cashback_percent| int %}
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group row">
                <div class="col-sm-4 mt-2">
                  <div class="custom-control custom-radio">
                    <input type="radio" id="cashback_flat" name="cashback_type" class="custom-control-input"
                      {{ 'checked' if (flat!=0) else '' }} value="flat">
                    <label class="custom-control-label" for="cashback_flat">Per Txn Cashback (Flat)</label>
                  </div>
                </div>
                <div class="col-sm-8">
                  <input name="per_Transaction_cashback_flat" id="per_Transaction_cashback_flat" class="form-control"
                    tabindex="11" value="{{offer.per_Transaction_cashback_flat}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-sm-4 mt-2">
                  <div class="custom-control custom-radio">
                    <input type="radio" id="cashback_percent" name="cashback_type" class="custom-control-input"
                      {{"checked" if (percent!=0) else "" }} value="percent">
                    <label class="custom-control-label" for="cashback_percent">Per Txn Cashback (%)</label>
                  </div>
                </div>
                <div class="col-sm-8">
                  <input name="per_Transaction_cashback_percent" id="per_Transaction_cashback_percent"
                    class="form-control" tabindex="9" value="{{offer.per_Transaction_cashback_percent}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>

            </div>
            <div class="col-lg-6">
              <div class="d-none d-lg-block" style="height: 59px;"></div>
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Per Txn Max Cashback</label>
                <div class="col-sm-9">
                  <input name="per_Transaction_max_cashback" id="per_Transaction_max_cashback" class="form-control"
                    tabindex="8" value="{{offer.per_Transaction_max_cashback}}">
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <hr class="dark-line">
          <div class="row">

            <div class="col-lg-6">





              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Frequency</label>
                <div class="col-sm-9">
                  <select name="frequency" id="frequency" class="form-control" tabindex="12">
                    <option value="{{offer.frequency}}">
                      {{"Once during offer" if ('once'==offer.frequency) else "" }}
                      {{"Max 3 Transactions" if ('max_3_txn'==offer.frequency) else "" }}
                    </option>
                    {% if ('once'!=offer.frequency)%}
                    <option value="once">Once during offer</option>
                    {% endif %}
                    {% if ('max_3_txn'!=offer.frequency)%}
                    <option value="max_3_txn">Max 3 Transactions</option>
                    {% endif %}
                  
                  </select>
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="form-group row">
                <label class="col-sm-3 col-form-label text-right">Apply</label>
                <div class="col-sm-9">
                  <select name="apply" id="apply" class="form-control" tabindex="13">

                    <option value="immediately">Immediately</option>

                  </select>
                  <ul class="parsley-errors-list">
                    <li class="parsley-required"></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
      </div>
      <div class="row mb-2">
        <div class="col-md-3 col-12 ml-auto" style="margin-bottom: inherit;">
          <button type="submit" class="btn btn-soft-primary btn-block">Save</button>
        </div>
        <div class="col-md-3 col-12 mr-auto">
          <a class="btn btn-soft-danger btn-block" href="/offers/list">Cancel</a>
        </div>
      </div>
      </form>
    </div>
  </div>
  <!--end card-body-->
</div>
<!--end card-->
</div>

<!--end col-->
</div>

<script>
  function setError(el, msg) {
    el.addClass('parsley-error');
    el.next().addClass('filled');
    el.next().children(":first").html(msg);
  }

  function removeError(el) {
    el.removeClass('parsley-error');
    el.next().removeClass('filled');
  }

  $(document).ready(function () {

    $('#form').submit(function (e) {
      e.preventDefault();

      const required = ['transaction_label', 'card_program', 'offer_name', 'mcc', 'mid', 'min_spend', 'offer_start_date', 'apply', 'frequency'];
      let error = false;
      for (var i = 0; i < required.length; i++) {
        var el = $(`#${required[i]}`);
        console.log(el);
        if (el.val().length === 0) {
          var label = el.parent().parent().find('label').text();
          setError(el, `${label} is required`);
          error = true;
        }
        else {
          removeError(el);
        }
      }
      if ($('#cashback_type_percent').is(':checked')) {
        const required = ['per_Transaction_max_cashback', 'per_Transaction_cashback_percent'];
        let error = false;
        for (var i = 0; i < required.length; i++) {
          var el = $(`#${required[i]}`);
          console.log(el);
          if (el.val().length === 0) {
            var label = el.parent().parent().find('label').text();
            setError(el, `${label} is required`);
            error = true;
          }
          else {
            removeError(el);
          }
        }
        const required2 = ['per_Transaction_cashback_flat'];
        for (var i = 0; i < required2.length; i++) {
          var el = $(`#${required2[i]}`);
          if (el.hasClass("parsley-error")) {
            removeError(el);

          }
        }
      }

      else if ($('#cashback_type_flat').is(':checked')) {
        const required = ['per_Transaction_cashback_flat'];
        let error = false;
        for (var i = 0; i < required.length; i++) {
          var el = $(`#${required[i]}`);
          console.log(el);
          if (el.val().length === 0) {
            var label = el.parent().parent().find('label').text();
            setError(el, `${label} is required`);
            error = true;
          }
          else {
            removeError(el);
          }
        }
        const required2 = ['per_Transaction_max_cashback', 'per_Transaction_cashback_percent'];
        for (var i = 0; i < required2.length; i++) {
          var el = $(`#${required2[i]}`);
          if (el.hasClass("parsley-error")) {
            removeError(el);
          }

        }
      }

      if (!error) {
        this.submit();
      }
    });

  });
  $('#mid').on('input', function () {
    $('#')
  });
  function DateValidation() {
    var start = document.getElementById("offer_start_date");
    var end = document.getElementById("offer_end_date");
    end.min = start.value;
  }
</script>

{% endblock %}